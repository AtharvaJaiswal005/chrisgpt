<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ChrisGPT</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --bg-primary: #212121;
            --bg-secondary: #171717;
            --bg-tertiary: #2f2f2f;
            --bg-hover: #3a3a3a;
            --bg-user-msg: #303030;
            --text-primary: #ececec;
            --text-secondary: #b4b4b4;
            --text-muted: #8e8e8e;
            --border: #424242;
            --accent: #f97316;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        .app {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background-color: var(--bg-secondary);
            display: flex;
            flex-direction: column;
            height: 100vh;
            flex-shrink: 0;
            transition: width 0.3s ease, transform 0.3s ease;
            overflow: hidden;
        }

        .sidebar.collapsed {
            width: 0;
        }

        .sidebar-header {
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sidebar-toggle {
            width: 36px;
            height: 36px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s, color 0.2s;
            flex-shrink: 0;
        }

        .sidebar-toggle:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .sidebar-toggle svg {
            width: 20px;
            height: 20px;
        }

        .new-chat-btn {
            flex: 1;
            padding: 10px 12px;
            background: transparent;
            color: var(--text-primary);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.2s;
            white-space: nowrap;
        }

        .new-chat-btn:hover {
            background: var(--bg-tertiary);
        }

        .new-chat-btn svg {
            width: 18px;
            height: 18px;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 4px 12px;
        }

        .sidebar-content::-webkit-scrollbar {
            width: 4px;
        }

        .sidebar-content::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 2px;
        }

        .chat-history-item {
            width: 100%;
            padding: 10px 12px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 14px;
            cursor: pointer;
            text-align: left;
            transition: background 0.2s;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chat-history-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .chat-history-item.active {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .chat-history-item svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            opacity: 0.7;
        }

        .chat-history-item span {
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        .delete-chat-btn {
            display: none;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .delete-chat-btn:hover {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .chat-history-item:hover .delete-chat-btn {
            display: flex;
        }

        /* Main Content */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-primary);
            min-width: 0;
            position: relative;
        }

        .main-header {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-toggle {
            display: none;
            width: 36px;
            height: 36px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 8px;
            align-items: center;
            justify-content: center;
            transition: background 0.2s, color 0.2s;
        }

        .header-toggle:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .header-toggle svg {
            width: 20px;
            height: 20px;
        }

        .sidebar.collapsed ~ .main .header-toggle {
            display: flex;
        }

        .model-selector {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .model-selector:hover {
            background: var(--bg-tertiary);
        }

        .model-selector svg {
            width: 16px;
            height: 16px;
            opacity: 0.6;
        }

        /* Chat Area */
        .chat-container {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .chat-container::-webkit-scrollbar {
            width: 6px;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        /* Welcome Screen */
        .welcome {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }

        .welcome-title {
            font-size: 28px;
            font-weight: 500;
            margin-bottom: 32px;
            color: var(--text-primary);
        }

        .suggestions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            width: 100%;
            max-width: 600px;
        }

        .suggestion-card {
            padding: 14px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
        }

        .suggestion-card:hover {
            background: var(--bg-hover);
            border-color: var(--text-muted);
        }

        .suggestion-icon {
            width: 20px;
            height: 20px;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .suggestion-title {
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .suggestion-desc {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Messages */
        .messages-container {
            flex: 1;
            padding: 20px 0;
        }

        .message {
            max-width: 800px;
            margin: 0 auto 24px;
            padding: 0 20px;
            width: 100%;
        }

        .message.user-message {
            display: flex;
            justify-content: flex-end;
        }

        .user-bubble {
            background: var(--bg-user-msg);
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 70%;
            font-size: 15px;
            line-height: 1.5;
        }

        .bot-content {
            font-size: 15px;
            line-height: 1.7;
            color: var(--text-primary);
        }

        .bot-content p {
            margin-bottom: 12px;
        }

        .bot-content p:last-child {
            margin-bottom: 0;
        }

        .bot-content ul, .bot-content ol {
            margin: 12px 0;
            padding-left: 24px;
        }

        .bot-content li {
            margin-bottom: 6px;
        }

        .bot-content code {
            background: var(--bg-secondary);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 13px;
        }

        .bot-content pre {
            background: var(--bg-secondary);
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 12px 0;
        }

        .bot-content strong {
            font-weight: 600;
        }

        /* Message Actions */
        .message-actions {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-top: 12px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .action-btn {
            width: 28px;
            height: 28px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s, color 0.2s;
        }

        .action-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .action-btn svg {
            width: 16px;
            height: 16px;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 8px 0;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--text-muted);
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* Input Area */
        .input-area {
            padding: 16px 20px 24px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }

        .input-container {
            display: flex;
            align-items: center;
            gap: 0;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 26px;
            padding: 6px 6px 6px 16px;
            transition: border-color 0.2s;
        }

        .input-container:focus-within {
            border-color: var(--text-muted);
        }

        .attach-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
        }

        .attach-btn:hover {
            color: var(--text-primary);
        }

        .attach-btn svg {
            width: 20px;
            height: 20px;
        }

        #message-input {
            flex: 1;
            padding: 10px 12px;
            border: none;
            background: transparent;
            color: var(--text-primary);
            font-size: 15px;
            font-family: inherit;
            outline: none;
            resize: none;
            max-height: 200px;
            line-height: 1.5;
        }

        #message-input::placeholder {
            color: var(--text-muted);
        }

        .input-actions {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .voice-btn {
            width: 36px;
            height: 36px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .voice-btn:hover {
            color: var(--text-primary);
            background: var(--bg-hover);
        }

        .voice-btn svg {
            width: 20px;
            height: 20px;
        }

        .send-btn {
            width: 36px;
            height: 36px;
            background: var(--text-primary);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .send-btn:hover:not(:disabled) {
            background: #fff;
        }

        .send-btn:disabled {
            background: var(--bg-hover);
            cursor: not-allowed;
        }

        .send-btn svg {
            width: 18px;
            height: 18px;
            color: var(--bg-primary);
        }

        .send-btn:disabled svg {
            color: var(--text-muted);
        }

        .input-footer {
            text-align: center;
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 12px;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 100;
            border: 1px solid var(--border);
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* Mobile */
        .sidebar-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 40;
            -webkit-tap-highlight-color: transparent;
        }

        @media (max-width: 768px) {
            html {
                height: 100%;
            }

            body {
                height: 100%;
                min-height: 100%;
                min-height: -webkit-fill-available;
            }

            .app {
                height: 100%;
                min-height: 100vh;
                min-height: -webkit-fill-available;
            }

            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                z-index: 50;
                transform: translateX(-100%);
                width: 280px;
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .sidebar-overlay.show {
                display: block;
            }

            .header-toggle {
                display: flex !important;
            }

            .main {
                width: 100%;
                height: 100%;
                display: flex;
                flex-direction: column;
            }

            .chat-container {
                flex: 1;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            .welcome {
                padding: 20px 16px;
                justify-content: center;
                align-items: center;
                min-height: 100%;
            }

            .welcome-title {
                font-size: 22px;
                text-align: center;
                margin-bottom: 28px;
            }

            .suggestions {
                grid-template-columns: 1fr;
                gap: 10px;
                width: 100%;
                max-width: 400px;
            }

            .suggestion-card {
                padding: 14px 16px;
            }

            .suggestion-icon {
                width: 20px;
                height: 20px;
                margin-bottom: 8px;
            }

            .suggestion-title {
                font-size: 14px;
            }

            .suggestion-desc {
                font-size: 12px;
            }

            .message {
                padding: 0 16px;
                margin-bottom: 16px;
            }

            .user-bubble {
                max-width: 85%;
                padding: 10px 14px;
                font-size: 15px;
            }

            .bot-content {
                font-size: 15px;
                line-height: 1.6;
            }

            .message-actions {
                opacity: 1;
                margin-top: 8px;
            }

            .input-area {
                padding: 12px 16px;
                padding-bottom: 16px;
                background: var(--bg-primary);
                flex-shrink: 0;
            }

            .input-container {
                padding: 6px 6px 6px 14px;
                border-radius: 24px;
            }

            #message-input {
                font-size: 16px;
                padding: 10px 8px;
            }

            .attach-btn {
                padding: 6px;
            }

            .attach-btn svg {
                width: 20px;
                height: 20px;
            }

            .voice-btn, .send-btn {
                width: 36px;
                height: 36px;
            }

            .voice-btn svg, .send-btn svg {
                width: 18px;
                height: 18px;
            }

            .input-footer {
                font-size: 11px;
                margin-top: 10px;
            }

            .main-header {
                padding: 12px 16px;
                flex-shrink: 0;
            }

            .model-selector {
                font-size: 15px;
                padding: 8px 12px;
            }

            .toast {
                bottom: 100px;
                font-size: 14px;
                padding: 12px 20px;
            }

            .messages-container {
                padding: 16px 0;
            }
        }

        /* Extra small devices */
        @media (max-width: 380px) {
            .welcome-title {
                font-size: 20px;
            }

            .suggestion-title {
                font-size: 13px;
            }

            .suggestion-desc {
                font-size: 11px;
            }

            .suggestion-card {
                padding: 12px 14px;
            }
        }

        /* Safe area for notched phones */
        @supports (padding-bottom: env(safe-area-inset-bottom)) {
            @media (max-width: 768px) {
                .input-area {
                    padding-bottom: calc(16px + env(safe-area-inset-bottom));
                }

                .main-header {
                    padding-top: calc(12px + env(safe-area-inset-top));
                }
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <button class="sidebar-toggle" onclick="toggleSidebar()" title="Close sidebar">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M11 19l-7-7 7-7m8 14l-7-7 7-7" />
                    </svg>
                </button>
                <button class="new-chat-btn" onclick="startNewChat()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                    </svg>
                    New chat
                </button>
            </div>
            <div class="sidebar-content" id="chat-history"></div>
        </aside>

        <main class="main">
            <header class="main-header">
                <button class="header-toggle" onclick="toggleSidebar()" title="Open sidebar">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
                <button class="model-selector">
                    ChrisGPT
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                    </svg>
                </button>
            </header>

            <div class="chat-container" id="chat-container">
                <div class="welcome" id="welcome">
                    <h1 class="welcome-title" id="welcome-title">Where should we begin?</h1>
                    <div class="suggestions">
                        <button class="suggestion-card" onclick="sendSuggestion('How do I handle price objections without discounting?')">
                            <svg class="suggestion-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <div class="suggestion-title">Handle price objections</div>
                            <div class="suggestion-desc">without discounting</div>
                        </button>
                        <button class="suggestion-card" onclick="sendSuggestion('Give me a killer closing technique for high-ticket sales')">
                            <svg class="suggestion-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
                            </svg>
                            <div class="suggestion-title">Killer closing technique</div>
                            <div class="suggestion-desc">for high-ticket sales</div>
                        </button>
                        <button class="suggestion-card" onclick="sendSuggestion('How do I build instant rapport with prospects?')">
                            <svg class="suggestion-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            <div class="suggestion-title">Build instant rapport</div>
                            <div class="suggestion-desc">with prospects</div>
                        </button>
                        <button class="suggestion-card" onclick="sendSuggestion('Craft a follow-up message for a cold lead')">
                            <svg class="suggestion-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                            </svg>
                            <div class="suggestion-title">Follow-up message</div>
                            <div class="suggestion-desc">for a cold lead</div>
                        </button>
                    </div>
                </div>

                <div class="messages-container" id="messages-container" style="display: none;"></div>
            </div>

            <div class="input-area">
                <div class="input-container">
                    <button class="attach-btn" title="Attach file">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                        </svg>
                    </button>
                    <input type="text" id="message-input" placeholder="Ask anything" autocomplete="off">
                    <div class="input-actions">
                        <button class="voice-btn" onclick="showVoiceToast()" title="Voice input">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                            </svg>
                        </button>
                        <button class="send-btn" id="send-button">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                            </svg>
                        </button>
                    </div>
                </div>
                <p class="input-footer">ChrisGPT can make mistakes. Check important info.</p>
            </div>
        </main>
    </div>

    <div class="toast" id="toast">Voice chat coming soon!</div>

    <script>
        const webhookUrl = 'https://dimabilous.app.n8n.cloud/webhook/5e3f2ade-9a6f-44b8-8d90-5af679568722/chat';

        // DOM Elements
        const chatContainer = document.getElementById('chat-container');
        const messagesContainer = document.getElementById('messages-container');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const welcome = document.getElementById('welcome');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const chatHistoryEl = document.getElementById('chat-history');
        const toast = document.getElementById('toast');

        // State
        let chats = JSON.parse(localStorage.getItem('chrisgpt_chats') || '[]');
        let currentChatId = null;
        let sidebarOpen = window.innerWidth > 768;

        // Welcome phrases
        const welcomePhrases = [
            "Where should we begin?",
            "Alright, what's the fire we're putting out today?",
            "Hit me, what's the situation?",
            "Okay, give me the messy version first.",
            "What's been driving you slightly insane lately?",
            "What prompted you to reach out now?"
        ];

        function setRandomWelcomePhrase() {
            const randomIndex = Math.floor(Math.random() * welcomePhrases.length);
            document.getElementById('welcome-title').textContent = welcomePhrases[randomIndex];
        }

        // Initialize
        function init() {
            // On mobile, sidebar starts closed
            if (window.innerWidth <= 768) {
                sidebarOpen = false;
                sidebar.classList.remove('open');
            } else {
                // On desktop, sidebar starts open
                sidebarOpen = true;
                sidebar.classList.remove('collapsed');
            }
            setRandomWelcomePhrase();
            renderChatHistory();

            // Don't auto-focus on mobile to prevent keyboard popup
            if (window.innerWidth > 768) {
                messageInput.focus();
            }
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth <= 768) {
                sidebar.classList.remove('collapsed');
                if (!sidebarOpen) {
                    sidebar.classList.remove('open');
                }
            } else {
                sidebar.classList.remove('open');
                sidebarOverlay.classList.remove('show');
                if (!sidebarOpen) {
                    sidebar.classList.add('collapsed');
                }
            }
        });

        // Toggle sidebar
        function toggleSidebar() {
            sidebarOpen = !sidebarOpen;

            if (window.innerWidth <= 768) {
                // Mobile: use open class
                sidebar.classList.toggle('open', sidebarOpen);
                sidebarOverlay.classList.toggle('show', sidebarOpen);
            } else {
                // Desktop: use collapsed class
                sidebar.classList.toggle('collapsed', !sidebarOpen);
            }
        }

        sidebarOverlay.addEventListener('click', () => {
            sidebarOpen = false;
            sidebar.classList.remove('open');
            sidebarOverlay.classList.remove('show');
        });

        // Show voice toast
        function showVoiceToast() {
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // Start new chat
        function startNewChat() {
            currentChatId = null;
            messagesContainer.innerHTML = '';
            messagesContainer.style.display = 'none';
            welcome.style.display = 'flex';
            setRandomWelcomePhrase();
            renderChatHistory();

            if (window.innerWidth <= 768) {
                sidebarOpen = false;
                sidebar.classList.remove('open');
                sidebarOverlay.classList.remove('show');
            }
            messageInput.focus();
        }

        // Create new chat
        function createNewChat(firstMessage) {
            const chat = {
                id: Date.now().toString(),
                sessionId: 'session-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
                title: firstMessage.slice(0, 30) + (firstMessage.length > 30 ? '...' : ''),
                messages: [],
                createdAt: new Date().toISOString()
            };
            chats.unshift(chat);
            currentChatId = chat.id;
            saveChats();
            renderChatHistory();
            return chat;
        }

        // Get current chat
        function getCurrentChat() {
            return chats.find(c => c.id === currentChatId);
        }

        // Save chats to localStorage
        function saveChats() {
            localStorage.setItem('chrisgpt_chats', JSON.stringify(chats));
        }

        // Load chat
        function loadChat(chatId) {
            const chat = chats.find(c => c.id === chatId);
            if (!chat) return;

            currentChatId = chatId;
            welcome.style.display = 'none';
            messagesContainer.style.display = 'block';
            messagesContainer.innerHTML = '';

            chat.messages.forEach(msg => {
                appendMessage(msg.content, msg.role, false);
            });

            renderChatHistory();

            if (window.innerWidth <= 768) {
                sidebarOpen = false;
                sidebar.classList.remove('open');
                sidebarOverlay.classList.remove('show');
            }
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Delete chat
        function deleteChat(chatId, event) {
            event.stopPropagation();
            chats = chats.filter(c => c.id !== chatId);
            saveChats();

            if (currentChatId === chatId) {
                startNewChat();
            } else {
                renderChatHistory();
            }
        }

        // Render chat history
        function renderChatHistory() {
            chatHistoryEl.innerHTML = '';

            chats.forEach(chat => {
                const item = document.createElement('button');
                item.className = 'chat-history-item' + (chat.id === currentChatId ? ' active' : '');
                item.onclick = () => loadChat(chat.id);
                item.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                    </svg>
                    <span>${escapeHtml(chat.title)}</span>
                    <button class="delete-chat-btn" onclick="deleteChat('${chat.id}', event)" title="Delete">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                    </button>
                `;
                chatHistoryEl.appendChild(item);
            });
        }

        // Copy text
        function copyText(text) {
            navigator.clipboard.writeText(text).then(() => {
                const toast = document.getElementById('toast');
                toast.textContent = 'Copied to clipboard!';
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                    toast.textContent = 'Voice chat coming soon!';
                }, 1500);
            });
        }

        // Append message to UI
        function appendMessage(content, role, save = true) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message' + (role === 'user' ? ' user-message' : '');

            if (role === 'user') {
                messageDiv.innerHTML = `<div class="user-bubble">${escapeHtml(content)}</div>`;
            } else {
                messageDiv.innerHTML = `
                    <div class="bot-content">${marked.parse(content)}</div>
                    <div class="message-actions">
                        <button class="action-btn" onclick="copyText(\`${content.replace(/`/g, '\\`').replace(/\$/g, '\\$')}\`)" title="Copy">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                        </button>
                        <button class="action-btn" title="Good response">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5" />
                            </svg>
                        </button>
                        <button class="action-btn" title="Bad response">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018a2 2 0 01.485.06l3.76.94m-7 10v5a2 2 0 002 2h.096c.5 0 .905-.405.905-.904 0-.715.211-1.413.608-2.008L17 13V4m-7 10h2m5-10h2a2 2 0 012 2v6a2 2 0 01-2 2h-2.5" />
                            </svg>
                        </button>
                        <button class="action-btn" title="Regenerate">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                        </button>
                    </div>
                `;
            }

            messagesContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;

            // Save to current chat
            if (save && currentChatId) {
                const chat = getCurrentChat();
                if (chat) {
                    chat.messages.push({ role, content });
                    saveChats();
                }
            }
        }

        // Show typing indicator
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message';
            typingDiv.id = 'typing-message';
            typingDiv.innerHTML = `
                <div class="bot-content">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(typingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Hide typing indicator
        function hideTypingIndicator() {
            const typingDiv = document.getElementById('typing-message');
            if (typingDiv) typingDiv.remove();
        }

        // Send message
        function sendMessage(message = null) {
            const msg = message || messageInput.value.trim();
            if (!msg) return;

            // Create new chat if needed
            if (!currentChatId) {
                createNewChat(msg);
            }

            // Show messages view
            welcome.style.display = 'none';
            messagesContainer.style.display = 'block';

            // Add user message
            appendMessage(msg, 'user');
            messageInput.value = '';
            sendButton.disabled = true;

            showTypingIndicator();

            const chat = getCurrentChat();

            fetch(webhookUrl + '?action=sendMessage', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chatInput: msg,
                    sessionId: chat ? chat.sessionId : 'session-' + Date.now()
                })
            })
            .then(response => response.json())
            .then(data => {
                hideTypingIndicator();
                const botResponse = data.output || data.response || 'Sorry, I couldn\'t understand that.';
                appendMessage(botResponse, 'assistant');
                sendButton.disabled = false;
                messageInput.focus();
            })
            .catch(error => {
                hideTypingIndicator();
                appendMessage('**Connection Error:** ' + error.message + '. Please try again.', 'assistant');
                sendButton.disabled = false;
                messageInput.focus();
            });
        }

        // Send suggestion
        function sendSuggestion(text) {
            sendMessage(text);
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Event listeners
        sendButton.addEventListener('click', () => sendMessage());
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Initialize
        init();
    </script>
</body>
</html>
